<div id="app">
	<h2>${event?.name}</h2>

	<div class='alert alert-success text-center' v-if="saved">Changes saved successfully!</div>

	<div v-if="event != null">

		<div class='card card-body mb-3'>
			<h3 class='text-center'>Event Details</h3>
			<form method='post' @submit.prevent="save">
				<div class="row row-cols-1 row-cols-lg-2">
					<div class='col form-group mb-3'>
						<label class='form-label' for='name'>Name</label>
						<input type='text' class='form-control' id='name' name='name' placeholder='Name' v-model='event.name' maxlength="255" required />
					</div>

					<div class='col form-group mb-3'>
						<label class='form-label' for='date'>Date</label>
						<input type='date' class='form-control' id='date' name='date' placeholder='Date' v-model='event.date' required />
					</div>
				</div>

				<div class='row row-cols-1 row-cols-lg-2'>
					<div class='col form-group mb-3'>
						<label class='form-label' for='start'>Start</label>
						<input type='time' class='form-control' id='start' name='start' v-model="event.startTime" required />
					</div>
					<div class='col form-group mb-3'>
						<label class='form-label' for='end'>End Time</label>
						<input type='time' class='form-control' id='end' name='end' v-model="event.endTime" required />
					</div>
				</div>

				<div class='form-group mb-3'>
					<label class='form-label' for='status'>Status</label>
					<select id="status" name="status" class="form-control" v-model="event.status">
						<option v-for="status in statuses" :value="status.toLowerCase()">${status}</option>
					</select>
				</div>

				<div class="card card-body mb-3">
					<h3>Address</h3>
					<div class="form-group mb-3">
						<label class="form-label" for="lineOne">Address Line 1</label>
						<input type="text" class="form-control" id="lineOne" name="lineOne" maxlength="100" placeholder="Address Line 1" required v-model="event.address.line1 ?? ''"/>
					</div>

					<div class="form-group mb-3">
						<label class="form-label" for="lineTwo">Address Line 2</label>
						<input type="text" class="form-control" id="lineTwo" name="lineTwo" maxlength="100" placeholder="Address Line 2" v-model="event.address.line2 ?? ''" />
					</div>

					<div class="form-group mb-3">
						<label class="form-label" for="city">Town/City</label>
						<input type="text" class="form-control" id="city" name="city" maxlength="100" placeholder="Town/City" required v-model="event.address.townCity ?? ''" />
					</div>

					<div class="form-group mb-3">
						<label class="form-label" for="postcode">Postcode</label>
						<input type="text" class="form-control" id="postcode" name="postcode" maxlength="10" placeholder="Postcode" required v-model="event.address.postcode ?? ''" />
					</div>

				</div>

				{{#if session.user.IsAdmin}}
				<div class='text-center'>
					<button class='btn btn-default'>Save</button>
				</div>
			</form>
			{{/if}}
		</div>
	</div>
</div>

<script src="/js/vue.js"></script>
<script>
	const app = new Vue({
		delimiters: ['${', '}'],
		el: '#app',
		data: {
			event: null,
			saved: false,
			statuses: ["Draft", "Internal", "Announced", "Finalised", "Complete"]
		},
		mounted: function () {
			fetch(`https://dev.payload.byba.online/api/events/{{id}}`, {
				credentials: "include"
			}).then(res => res.json())
				.then(json => {
					this.event = json;
					this.event.date = this.getDate(this.event.date);

					console.log(this.event);

					document.title = document.title.replace("Loading...", json.name);
				});
		},
		methods: {
			getDate: function (rawDate) {
				const date = new Date(rawDate);
				return [date.getFullYear(), (date.getMonth() + 1).toString().padStart(2, "0"), date.getDate().toString().padStart(2, "0")].join("-");
			},
			save: function () {
				fetch(`https://dev.payload.byba.online/api/events/{{id}}`, {
					method: "PATCH",
					credentials: "include",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify(this.event)
				})
			}
		}
	});
</script>